(()=>{"use strict";const e=".",t=Symbol("target"),n=Symbol("unsubscribe");function i(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}var s=Array.isArray;function r(e){return"symbol"==typeof e}const a={after:(e,t)=>s(e)?e.slice(t.length):""===t?e:e.slice(t.length+1),concat:(t,n)=>s(t)?(t=[...t],n&&t.push(n),t):n&&void 0!==n.toString?(""!==t&&(t+=e),r(n)?t+n.toString():t+n):t,initial:t=>{if(s(t))return t.slice(0,-1);if(""===t)return t;const n=t.lastIndexOf(e);return-1===n?"":t.slice(0,n)},last:t=>{if(s(t))return t[t.length-1]||"";if(""===t)return t;const n=t.lastIndexOf(e);return-1===n?t:t.slice(n+1)},walk:(t,n)=>{if(s(t))for(const e of t)n(e);else if(""!==t){let i=0,s=t.indexOf(e);if(-1===s)n(t);else for(;i<t.length;)-1===s&&(s=t.length),n(t.slice(i,s)),i=s+1,s=t.indexOf(e,i)}},get(e,t){return this.walk(t,(t=>{e&&(e=e[t])})),e}};function o(e,t,n){return e.isUnsubscribed||t.ignoreSymbols&&r(n)||t.ignoreUnderscores&&"_"===n.charAt(0)||"ignoreKeys"in t&&t.ignoreKeys.includes(n)}class l{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){const t=this._getDescriptorCache();let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);const n=this._getProperties(e);let i=n[t];return void 0===i&&(i=Reflect.getOwnPropertyDescriptor(e,t),n[t]=i),i}getProxy(e,t,n,i){if(this.isUnsubscribed)return e;const s=e[i],r=s||e;this._pathCache.set(r,t);let a=this._proxyCache.get(r);return void 0===a&&(a=void 0===s?new Proxy(e,n):e,this._proxyCache.set(r,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,a.get(t,this.getPath(e)))}defineProperty(e,t,n){return!!Reflect.defineProperty(e,t,n)&&(this.isUnsubscribed||(this._getProperties(e)[t]=n),!0)}setProperty(e,t,n,i,s){if(!this._equals(s,n)||!(t in e)){const s=this._getOwnPropertyDescriptor(e,t);return void 0!==s&&"set"in s?Reflect.set(e,t,n,i):Reflect.set(e,t,n)}return!0}deleteProperty(e,t,n){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){const i=this._getDescriptorCache().get(e);i&&(delete i[t],this._pathCache.delete(n))}return!0}return!1}isSameDescriptor(e,t,n){const i=this._getOwnPropertyDescriptor(t,n);return void 0!==e&&void 0!==i&&Object.is(e.value,i.value)&&(e.writable||!1)===(i.writable||!1)&&(e.enumerable||!1)===(i.enumerable||!1)&&(e.configurable||!1)===(i.configurable||!1)&&e.get===i.get&&e.set===i.set}isGetInvariant(e,t){const n=this._getOwnPropertyDescriptor(e,t);return void 0!==n&&!0!==n.configurable&&!0!==n.writable}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}}function d(e){return"[object Object]"===toString.call(e)}function h(){return!0}function c(e,t){return e.length!==t.length||e.some(((e,n)=>t[n]!==e))}const u=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),p=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),m={push:h,pop:h,shift:h,unshift:h,copyWithin:c,reverse:c,sort:c,splice:c,flat:c,fill:c},_=new Set([...u,...p,...Object.keys(m)]);function v(e,t){if(e.size!==t.size)return!0;for(const n of e)if(!t.has(n))return!0;return!1}const g=["keys","values","entries"],f=new Set(["has","toString"]),y={add:v,clear:v,delete:v,forEach:v},b=new Set([...f,...Object.keys(y),...g]);function w(e,t){if(e.size!==t.size)return!0;let n;for(const[i,s]of e)if(n=t.get(i),n!==s||void 0===n&&!t.has(i))return!0;return!1}const k=new Set([...f,"get"]),$={set:w,clear:w,delete:w,forEach:w},C=new Set([...k,...Object.keys($),...g]);class S{constructor(e,t,n,i){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=i,this._changes=i?[]:null,this.clone=void 0===t?e:this._shallowClone(e)}static isHandledMethod(e){return u.has(e)}_shallowClone(e){let t=e;if(d(e))t={...e};else if(s(e)||ArrayBuffer.isView(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map((e=>this._shallowClone(e))));else if(e instanceof Map){t=new Map;for(const[n,i]of e.entries())t.set(n,this._shallowClone(i))}return this._clonedCache.add(t),t}preferredThisArg(e,t,n,i){return e?(s(i)?this._onIsChanged=m[t]:i instanceof Set?this._onIsChanged=y[t]:i instanceof Map&&(this._onIsChanged=$[t]),i):n}update(e,t,n){const i=a.after(e,this._path);if("length"!==t){let e=this.clone;a.walk(i,(t=>{e&&e[t]&&(this._clonedCache.has(e[t])||(e[t]=this._shallowClone(e[t])),e=e[t])})),this._hasOnValidate&&this._changes.push({path:i,property:t,previous:n}),e&&e[t]&&(e[t]=n)}this._isChanged=!0}undo(e){let t;for(let n=this._changes.length-1;-1!==n;n--)t=this._changes[n],a.get(e,t.path)[t.property]=t.previous}isChanged(e){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,e)}}class M extends S{static isHandledMethod(e){return _.has(e)}}class E extends S{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}}class T extends S{static isHandledMethod(e){return b.has(e)}undo(e){for(const t of this.clone)e.add(t);for(const t of e)this.clone.has(t)||e.delete(t)}}class V extends S{static isHandledMethod(e){return C.has(e)}undo(e){for(const[t,n]of this.clone.entries())e.set(t,n);for(const t of e.keys())this.clone.has(t)||e.delete(t)}}class x extends S{constructor(e,t,n,i){super(void 0,t,n,i),this._arg1=n[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}}class H extends S{constructor(e,t,n,i){super(void 0,t,n,i),this._weakKey=n[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){const t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}}class L{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return d(e)||s(e)||i(e)}static isHandledMethod(e,t){return d(e)?S.isHandledMethod(t):s(e)?M.isHandledMethod(t):e instanceof Set?T.isHandledMethod(t):e instanceof Map?V.isHandledMethod(t):i(e)}get isCloning(){return this._stack.length>0}start(e,t,n){let i=S;s(e)?i=M:e instanceof Date?i=E:e instanceof Set?i=T:e instanceof Map?i=V:e instanceof WeakSet?i=x:e instanceof WeakMap&&(i=H),this._stack.push(new i(e,t,n,this._hasOnValidate))}update(e,t,n){this._stack[this._stack.length-1].update(e,t,n)}preferredThisArg(e,t,n){const{name:i}=e,s=L.isHandledMethod(n,i);return this._stack[this._stack.length-1].preferredThisArg(s,i,t,n)}isChanged(e,t,n){return this._stack[this._stack.length-1].isChanged(e,t,n)}undo(e){void 0!==this._previousClone&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}}const R={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},O=(e,s,d={})=>{d={...R,...d};const h=Symbol("ProxyTarget"),{equals:c,isShallow:u,ignoreDetached:p,details:m}=d,_=new l(c),v="function"==typeof d.onValidate,g=new L(v),f=(e,t,n,i,s)=>!v||g.isCloning||!0===d.onValidate(a.concat(_.getPath(e),t),n,i,s),y=(t,n,i,s)=>{o(_,d,n)||p&&_.isDetached(t,e)||b(_.getPath(t),n,i,s)},b=(e,t,n,i,r)=>{g.isCloning?g.update(e,t,i):s(a.concat(e,t),n,i,r)},w=e=>e&&e[h]||e,k=(t,n,i,s)=>function(e){return("object"==typeof e?null===e:"function"!=typeof e)||e instanceof RegExp}(t)||"constructor"===i||u&&!L.isHandledMethod(n,i)||o(_,d,i)||_.isGetInvariant(n,i)||p&&_.isDetached(n,e)?t:(void 0===s&&(s=_.getPath(n)),_.getProxy(t,a.concat(s,i),$,h)),$={get(e,s,a){if(r(s)){if(s===h||s===t)return e;if(s===n&&!_.isUnsubscribed&&0===_.getPath(e).length)return _.unsubscribe(),e}const o=i(e)?Reflect.get(e,s):Reflect.get(e,s,a);return k(o,e,s)},set(e,t,n,i){n=w(n);const s=e[h]||e,r=s[t];if(c(r,n)&&t in e)return!0;const a=f(e,t,n,r);return a&&_.setProperty(s,t,n,i,r)?(y(e,t,e[t],r),!0):!a},defineProperty(e,t,n){if(!_.isSameDescriptor(n,e,t)){const i=e[t];f(e,t,n.value,i)&&_.defineProperty(e,t,n,i)&&y(e,t,n.value,i)}return!0},deleteProperty(e,t){if(!Reflect.has(e,t))return!0;const n=Reflect.get(e,t),i=f(e,t,void 0,n);return i&&_.deleteProperty(e,t,n)?(y(e,t,void 0,n),!0):!i},apply(n,i,s){const r=i[h]||i;if(_.isUnsubscribed)return Reflect.apply(n,r,s);if((!1===m||!0!==m&&!m.includes(n.name))&&L.isHandledType(r)){let l=a.initial(_.getPath(n));const d=L.isHandledMethod(r,n.name);g.start(r,l,s);let h=Reflect.apply(n,g.preferredThisArg(n,i,r),d?s.map((e=>w(e))):s);const u=g.isChanged(r,c),p=g.stop();if(L.isHandledType(h)&&d&&(i instanceof Map&&"get"===n.name&&(l=a.concat(l,s[0])),h=_.getProxy(h,l,$)),u){const t={name:n.name,args:s,result:h},i=g.isCloning?a.initial(l):l,o=g.isCloning?a.last(l):"";f(a.get(e,i),o,r,p,t)?b(i,o,r,p,t):g.undo(r)}return(i instanceof Map||i instanceof Set)&&"object"==typeof(o=h)&&"function"==typeof o.next?function(e,n,i,s,r){const a=e.next;if("entries"===n.name)e.next=function(){const e=a.call(this);return!1===e.done&&(e.value[0]=r(e.value[0],n,e.value[0],s),e.value[1]=r(e.value[1],n,e.value[0],s)),e};else if("values"===n.name){const o=i[t].keys();e.next=function(){const e=a.call(this);return!1===e.done&&(e.value=r(e.value,n,o.next().value,s)),e}}else e.next=function(){const e=a.call(this);return!1===e.done&&(e.value=r(e.value,n,e.value,s)),e};return e}(h,n,i,l,k):h}var o;return Reflect.apply(n,i,s)}},C=_.getProxy(e,d.pathAsArray?[]:"",$);return s=s.bind(C),v&&(d.onValidate=d.onValidate.bind(C)),C};O.target=e=>e&&e[t]||e,O.unsubscribe=e=>e[n]||e;const P=document.createElement("template");P.innerHTML='\n    <style>\n        :host {\n            display: block;\n            margin-bottom: 12px;\n        }\n        button {\n            font-size: 20px;\n            font-style: \'bold\';\n            padding: 3px 5px;\n            color: white;\n            background: gray;\n        }\n        button[enabled="0"] {\n            background: red;\n        }\n        button[enabled="1"] {\n            background: green;\n        }\n    </style>\n    <button type="button" class="toggle-button"></button>\n';class A extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.props=O({enabled:!1,label:"",enabled_true_label:"ON",enabled_false_label:"OFF"},this.update.bind(this))}connectedCallback(){this.shadowRoot.appendChild(P.content.cloneNode(!0)),this.$button=this.shadowRoot.querySelector("button"),this.$button.onclick=this.buttonOnclick.bind(this),this.getAttribute("label")&&(this.props.label=this.getAttribute("label")),this.render()}buttonOnclick(e){"function"==typeof this.buttonClickedCallback&&this.buttonClickedCallback()}update(e,t,n){this.render()}render(){this.props.enabled?(this.$button.setAttribute("enabled","1"),this.$button.innerText=`${this.props.label}: ${this.props.enabled_true_label}`):(this.$button.setAttribute("enabled","0"),this.$button.innerText=`${this.props.label}: ${this.props.enabled_false_label}`)}}customElements.define("toggle-button",A);const N=document.createElement("template");N.innerHTML='\n    <table class="event-timers-list" border="1">\n        <thead>\n            <th>Relay</th>\n            <th>Days of Week</th>\n            <th>Time</th>\n            <th>Duration</th>\n            <th></th>\n            <th></th>\n        </thead>\n        <tbody>\n            \n        </tbody>\n    </table>\n';const q=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];class D extends HTMLElement{constructor(){super(),this.props=O({event_timers:[]},this.update.bind(this)),this.attachShadow({mode:"open"})}connectedCallback(){this.shadowRoot.appendChild(N.content.cloneNode(!0))}update(e,t,n){this.render()}editOnclick(e){const t=new CustomEvent("edit_event_timer",{bubbles:!0,composed:!0,detail:{event_timer_id:e}});this.dispatchEvent(t)}deleteOnclick(e){const t=new CustomEvent("delete_event_timer",{bubbles:!0,composed:!0,detail:{event_timer_id:e}});this.dispatchEvent(t)}render(){const e=this.shadowRoot.querySelector("tbody");if(e.innerHTML="",!this.props.event_timers.length){let t=document.createElement("tr"),n=document.createElement("td");return n.setAttribute("colspan",6),n.innerText="No event timers found",t.appendChild(n),e.appendChild(t),null}this.props.event_timers.map((t=>{let n=document.createElement("tr");e.appendChild(n);let i=document.createElement("template");i.innerHTML=`\n                <td>${t.relay_id}</td>\n                <td>${t.dow.split(",").map((e=>q[e])).join(", ")}</td>\n                <td>${t.hh}:${t.mm<10?"0":""}${t.mm}</td>\n                <td>${t.duration}</td>\n                <td><a class="edit">Edit</a></td>\n                <td><a class="delete">Delete</a></td>\n            `,n.appendChild(i.content.cloneNode(!0)),n.querySelector(".edit").onclick=this.editOnclick.bind(this,t._id),n.querySelector(".delete").onclick=this.deleteOnclick.bind(this,t._id)}))}}customElements.define("event-timers-list",D);const I=document.createElement("template"),F=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];I.innerHTML='\n    <div class="container">\n       \n    </div>    \n';class j extends HTMLElement{static formAssociated=!0;constructor(){super(),this._internals=this.attachInternals(),this._value="",this.props=O({dow:""},this.update.bind(this)),this.attachShadow({mode:"open",delegatesFocus:!0})}connectedCallback(){this.render(),this.validate()}update(e,t,n){"dow"==e&&(this._value=t,this._internals.setFormValue(this._value),this.render(),this.validate())}render(){this.shadowRoot.appendChild(I.content.cloneNode(!0));const e=this.shadowRoot.querySelector(".container");e.innerHTML="",F.map(((t,n)=>{const i=document.createElement("input"),s=document.createElement("div"),r=document.createElement("label");i.type="checkbox",i.checked=this.props.dow.split(",").includes(n.toString()),i.name="days-of-week",i.id="days-of-week-"+n,i.value=n,i.addEventListener("change",this.validate.bind(this)),r.setAttribute("for",i.id),r.innerText=t,s.appendChild(i),s.appendChild(r),e.appendChild(s)}))}validate(){const e=this.shadowRoot.querySelector(".container").querySelectorAll('input[type="checkbox"]'),t=[];if(e.forEach((e=>{e.checked&&t.push(e.value)})),this._value=t.join(","),this._internals.setFormValue(this._value),this._value.length)this._internals.setValidity({});else{const e=this.shadowRoot.querySelector("input");this._internals.setValidity({valueMissing:!0},"Choose at least one day of the week",e)}}get value(){return this._value}set value(e){this._value=e}get form(){return this._internals.form}get name(){return this.getAttribute("name")}get type(){return this.localName}get validity(){return this._internals.validity}get validationMessage(){return this._internals.validationMessage}get willValidate(){return this._internals.willValidate}checkValidity(){return this._internals.checkValidity()}reportValidity(){return this._internals.reportValidity()}}customElements.define("days-of-week-input",j);const U=document.createElement("template");U.innerHTML='\n    <div class="container">\n       <label for="relay_id">Relay</label>\n       <select name="relay_id" id="relay_id">\n           \n       </select>\n    </div>    \n';class K extends HTMLElement{static formAssociated=!0;static get observedAttributes(){return["relay_count"]}constructor(){super(),this._internals=this.attachInternals(),this._value="",this.props=O({relay_id:""},this.update.bind(this)),this.attachShadow({mode:"open"})}get relay_count(){return this.getAttribute("relay_count")}set relay_count(e){this.setAttribute("relay_count",e)}connectedCallback(){this.shadowRoot.appendChild(U.content.cloneNode(!0)),this.$select=this.shadowRoot.querySelector("select"),this.$select.addEventListener("change",(e=>{this._value=this.$select.options[e.target.selectedIndex].value,this._internals.setFormValue(this._value),this.validate()})),this.render(),this.validate()}update(e,t,n){"relay_id"==e&&(this._value=t,this._internals.setFormValue(this._value),this.render(),this.validate())}render(){this.$select.innerHTML='<option value="">Select relay...</option>';for(let e=1;e<=Number(this.relay_count);e++){const t=document.createElement("option");t.value=e,t.innerText=e,t.selected=e==Number(this.props.relay_id)?"selected":"",this.$select.appendChild(t)}}validate(){this._value.length?this._internals.setValidity({}):this._internals.setValidity({valueMissing:!0},"Select a relay",this.$select)}get value(){return this._value}set value(e){this._value=e}get form(){return this._internals.form}get name(){return this.getAttribute("name")}get type(){return this.localName}get validity(){return this._internals.validity}get validationMessage(){return this._internals.validationMessage}get willValidate(){return this._internals.willValidate}checkValidity(){return this._internals.checkValidity()}reportValidity(){return this._internals.reportValidity()}}customElements.define("relay-input",K);const W=document.createElement("template");W.innerHTML='\n    <div class="container">\n        <label for="hh">Hour</label>\n        <select name="hh" id="hh">\n           \n        </select>\n    </div>    \n';class Q extends HTMLElement{static formAssociated=!0;constructor(){super(),this._internals=this.attachInternals(),this._value="",this.props=O({hh:""},this.update.bind(this)),this.attachShadow({mode:"open"})}connectedCallback(){this.shadowRoot.appendChild(W.content.cloneNode(!0)),this.$select=this.shadowRoot.querySelector("select"),this.$select.addEventListener("change",(e=>{this.value=this.$select.options[e.target.selectedIndex].value})),this.value=this.props.hh,this.render()}update(e,t,n){this.value=t,this.render()}render(){this.$select.innerHTML='<option value="">Select hour...</option>';for(let e=1;e<=24;e++){const t=document.createElement("option");t.value=e,t.innerText=e,t.selected=e===this.props.hh,this.$select.appendChild(t)}}validate(){""===this._value?(this._internals.setValidity({valueMissing:!0},"Select the hour",this.$select),console.log("invalid")):(this._internals.setValidity({}),console.log("valid"))}get value(){return this._value}set value(e){this._value=e,this._internals.setFormValue(this._value),this.validate()}get form(){return this._internals.form}get name(){return this.getAttribute("name")}get type(){return this.localName}get validity(){return this._internals.validity}get validationMessage(){return this._internals.validationMessage}get willValidate(){return this._internals.willValidate}checkValidity(){return this._internals.checkValidity()}reportValidity(){return this._internals.reportValidity()}}customElements.define("hour-input",Q);const B=document.createElement("template");B.innerHTML='\n    <div class="container">\n        <label for="mm">Minute</label>\n        <select name="mm" id="mm">\n           \n        </select>\n    </div>    \n';class J extends HTMLElement{static formAssociated=!0;constructor(){super(),this._internals=this.attachInternals(),this._value="",this.props=O({mm:""},this.update.bind(this)),this.attachShadow({mode:"open"})}connectedCallback(){this.shadowRoot.appendChild(B.content.cloneNode(!0)),this.$select=this.shadowRoot.querySelector("select"),this.$select.addEventListener("change",(e=>{this.value=this.$select.options[e.target.selectedIndex].value})),this.value=this.props.mm,this.render()}update(e,t,n){this.value=t,this.render()}render(){this.$select.innerHTML='<option value="">Select minute...</option>';for(let e=0;e<=59;e++){const t=document.createElement("option");t.value=e,t.innerText=e<10?`0${e}`:e,t.selected=e===this.props.mm,this.$select.appendChild(t)}}validate(){""===this._value?this._internals.setValidity({valueMissing:!0},"Select the minute",this.$select):this._internals.setValidity({})}get value(){return this._value}set value(e){this._value=e,this._internals.setFormValue(this._value),this.validate()}get form(){return this._internals.form}get name(){return this.getAttribute("name")}get type(){return this.localName}get validity(){return this._internals.validity}get validationMessage(){return this._internals.validationMessage}get willValidate(){return this._internals.willValidate}checkValidity(){return this._internals.checkValidity()}reportValidity(){return this._internals.reportValidity()}}customElements.define("minute-input",J);const z=document.createElement("template");z.innerHTML='\n    <div class="container">\n        <label for="duration">Duration (minutes)</label>\n        <select name="duration" id="duration">\n           \n        </select>\n    </div>    \n';class G extends HTMLElement{static formAssociated=!0;static get observedAttributes(){}constructor(){super(),this._internals=this.attachInternals(),this._value="",this.props=O({duration:""},this.update.bind(this)),this.attachShadow({mode:"open"})}connectedCallback(){this.shadowRoot.appendChild(z.content.cloneNode(!0)),this.$select=this.shadowRoot.querySelector("select"),this.$select.addEventListener("change",(e=>{this._value=this.$select.options[e.target.selectedIndex].value,this._internals.setFormValue(this._value),this.validate()})),this.validate(),this.render()}update(e,t,n){this._value=t,this._internals.setFormValue(this._value),this.validate(),this.render()}render(){this.$select.innerHTML='<option value="">Select duration...</option>';for(let e=1;e<=59;e++){const t=document.createElement("option");t.value=e,t.innerText=e,t.selected=e===this.props.duration||"",this.$select.appendChild(t)}}validate(){""===this._value?this._internals.setValidity({valueMissing:!0},"Select the duration",this.$select):this._internals.setValidity({})}get value(){return this._value}set value(e){this._value=e}get form(){return this._internals.form}get name(){return this.getAttribute("name")}get type(){return this.localName}get validity(){return this._internals.validity}get validationMessage(){return this._internals.validationMessage}get willValidate(){return this._internals.willValidate}checkValidity(){return this._internals.checkValidity()}reportValidity(){return this._internals.reportValidity()}}customElements.define("duration-input",G);const X=document.createElement("template");X.innerHTML='\n    <form name="event-timer-form">\n        <div>\n            <relay-input name="relay_id" relay_count="3"></relay-input>\n        </div>\n        <div>\n            <days-of-week-input name="dow" tabindex="0"></days-of-week-input>\n        </div>\n        <div>\n            <hour-input name="hh"></hour-input>\n        </div>\n        <div>\n            <minute-input name="mm"></minute-input>\n        </div>\n        <div>\n            <duration-input name="duration"></duration-input>\n        </div>\n        <input type="submit"></input>\n    </form>\n';class Y extends HTMLElement{static get observedAttributes(){return["form_action"]}constructor(){super(),this.props=O({event_timer:{_id:0,relay_id:"",duration:"",hh:"",mm:"",dow:""},event_timer_added:null},this.update.bind(this)),this.attachShadow({mode:"open",delegatesFocus:!0}),this.$days_of_week_input=null}get form_action(){return this.getAttribute("form_action")}set form_action(e){this.setAttribute("form_action",e)}connectedCallback(){this.shadowRoot.appendChild(X.content.cloneNode(!0)),this.$form=this.shadowRoot.querySelector("form"),this.$days_of_week_input=this.shadowRoot.querySelector("days-of-week-input"),this.$hour_input=this.shadowRoot.querySelector("hour-input"),this.$minute_input=this.shadowRoot.querySelector("minute-input"),this.$relay_input=this.shadowRoot.querySelector("relay-input"),this.$duration_input=this.shadowRoot.querySelector("duration-input"),this.render()}update(e,t,n){this.$days_of_week_input&&(this.$days_of_week_input.props.dow=this.props.event_timer.dow),this.$relay_input&&(this.$relay_input.props.relay_id=this.props.event_timer.relay_id),this.$hour_input&&(this.$hour_input.props.hh=this.props.event_timer.hh),this.$minute_input&&(this.$minute_input.props.mm=this.props.event_timer.mm),this.$duration_input&&(this.$duration_input.props.duration=this.props.event_timer.duration)}render(){this.$form.addEventListener("submit",this.onFormSubmit.bind(this))}onFormSubmit(e){e.preventDefault();try{const e=Object.assign({},this.props.event_timer,{dow:this.$form.dow.value,relay_id:this.$form.relay_id.value,hh:Number(this.$form.hh.value),mm:Number(this.$form.mm.value),duration:Number(this.$form.duration.value)}),t="edit"==this.form_action?"update_event_timer":"add_event_timer",n=new CustomEvent(t,{bubbles:!0,composed:!0,detail:{event_timer:e,uid:String(Date.now().toString(32)+Math.random().toString(16)).replace(/\./g,"")}});this.dispatchEvent(n)}catch(e){console.error(e)}return!1}disconnectedCallback(){this.$form.removeEventListener("submit",this.onFormSubmit.bind(this)),this.props=null,this.$days_of_week_input=null,this.$hour_input=null,this.$minute_input=null,this.$relay_input=null,this.$duration_input=null}}customElements.define("event-timer-form",Y);const Z=document.createElement("template");Z.innerHTML='\n    <div class="button-container">\n        <toggle-button label="Event Timers"></toggle-button>\n    </div>\n    <div class="event-timers-list-container">\n        <event-timers-list></event-timers-list>\n        <div class="add-event-timer-container">\n            <a id="add-event-timer">Add event timer...</a>\n        </div>\n        <div class="event-timer-form-container"></div>\n    </div>\n    \n';class ee extends HTMLElement{constructor(){super(),this.props=O({event_timers_enabled:!1,event_timers:[],event_timer_added:null},this.update.bind(this)),this.attachShadow({mode:"open"}),this.$button=null,this.$event_timer_form=null}connectedCallback(){this.shadowRoot.appendChild(Z.content.cloneNode(!0)),this.$button=this.shadowRoot.querySelector("toggle-button"),this.$event_timers_list=this.shadowRoot.querySelector("event-timers-list"),this.$button.buttonClickedCallback=this.buttonOnclick.bind(this),this.shadowRoot.querySelector("#add-event-timer").addEventListener("click",(e=>{e.preventDefault(),this.renderForm(),this.$event_timer_form.form_action="add"})),this.addEventListener("edit_event_timer",(e=>{e.preventDefault(),this.renderForm(),this.$event_timer_form.form_action="edit",this.$event_timer_form.props.event_timer=this.props.event_timers.find((t=>t._id==e.detail.event_timer_id))}))}renderForm(){const e=this.shadowRoot.querySelector(".event-timer-form-container");e.innerHTML="",this.$event_timer_form=document.createElement("event-timer-form"),e.appendChild(this.$event_timer_form)}disconnectedCallback(){console.log("disconnected")}buttonOnclick(e){const t=new CustomEvent("toggle_event_timers",{bubbles:!0});this.dispatchEvent(t)}update(e,t,n){this.$button.props.enabled=this.props.event_timers_enabled,this.$event_timers_list.props.event_timers=this.props.event_timers.slice(),this.$event_timer_form&&"event_timer_changed"==e&&"deleted"!=t&&this.$event_timer_form.parentNode.removeChild(this.$event_timer_form)}render(){}}customElements.define("event-timers",ee);class te extends HTMLElement{constructor(){super(),this.props=O({relay_id:null,is_on:!1},this.update.bind(this)),this.$button=null}connectedCallback(){this.render(),this.setButtonProps()}buttonOnclick(e){const t=new CustomEvent("toggle",{bubbles:!0,composed:!0,detail:{relay_id:this.props.relay_id}});this.dispatchEvent(t)}update(e,t,n){this.setButtonProps()}setButtonProps(){this.$button&&(this.$button.props.enabled=this.props.is_on,this.$button.props.label=`Relay ${this.props.relay_id}`)}render(){this.$button=document.createElement("toggle-button"),this.$button.buttonClickedCallback=this.buttonOnclick.bind(this),this.appendChild(this.$button),this.className="relay-"+this.props.relay_id}}customElements.define("relays-list-item",te);class ne extends HTMLElement{constructor(){super(),this.props=O({relays:{}},this.update.bind(this))}connectedCallback(){this.render()}update(e,t,n){this.isConnected&&this.render()}render(){for(let e in this.props.relays){let t=this.querySelector("relays-list-item.relay-"+e);if(t)t.props.is_on="on"==this.props.relays[e];else{let t=document.createElement("relays-list-item");t.props.relay_id=e,t.props.is_on="on"==this.props.relays[e],this.appendChild(t)}}}}customElements.define("relays-list",ne);const ie=document.createElement("template");ie.innerHTML='\n    <style>\n        /*:host {\n            display: block;\n            margin-bottom: 12px;\n        }*/\n    </style>\n    <div class="datetime-container">\n    \n    </div>\n';class se extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.props=O({datetime:""},this.update.bind(this))}connectedCallback(){this.shadowRoot.appendChild(ie.content.cloneNode(!0)),this.render()}update(e,t,n){this.render()}render(){this.shadowRoot.querySelector(".datetime-container").innerText=this.props.datetime}}customElements.define("date-time",se);const re=document.createElement("template");re.innerHTML='\n    <style>\n        \n    </style>\n    <div id="app-container">\n        <date-time></date-time>\n        <relays-list></relays-list>\n        <event-timers></event-timers>\n    </div>\n';const ae="sprinklers/front",oe=new class{constructor(){this.state=O({relays:{},event_timers_enabled:!1,event_timers:[]},this.update.bind(this)),this.$el=re.content.cloneNode(!0),this.$relays_list=this.$el.querySelector("relays-list"),this.$event_timers=this.$el.querySelector("event-timers"),this.$app_container=this.$el.querySelector("#app-container"),this.$datetime=this.$el.querySelector("date-time"),this.$app_container.addEventListener("toggle",(e=>{this.onRelayToggle(e.detail.relay_id)})),this.$app_container.addEventListener("toggle_event_timers",(e=>{this.onEventTimersToggle()})),this.$app_container.addEventListener("update_event_timer",(e=>{this.onEventTimerUpdate(e.detail.event_timer)})),this.$app_container.addEventListener("delete_event_timer",(e=>{this.onEventTimerDelete(e.detail.event_timer_id)})),this.$app_container.addEventListener("add_event_timer",(e=>{this.onEventTimerAdd(e.detail.event_timer,e.detail.uid)}))}onRelayToggle(e){}onEventTimersToggle(){}onEventTimerUpdate(e){}onEventTimerDelete(e){}onEventTimerAdd(e,t){}update(e,t,n){this.$relays_list.props.relays=Object.assign({},this.state.relays),this.$datetime.props.datetime=this.state.datetime,this.$event_timers.props.event_timers_enabled=this.state.event_timers_enabled,this.$event_timers.props.event_timers=this.state.event_timers,this.$event_timers.props.event_timer_changed=this.state.event_timer_changed}};document.addEventListener("DOMContentLoaded",(function(){document.getElementById("main").appendChild(oe.$el)}));const le="sprinklers-front-"+Math.floor(1e3*Math.random()*(new Date).getTime()),de=new Paho.MQTT.Client("192.168.1.171",9001,le);de.onConnectionLost=function(e){0!==e.errorCode&&(console.log("onConnectionLost:"+e.errorMessage),he=!1)},de.onMessageArrived=function(e){console.log(e.destinationName,e.payloadString);try{if(e.destinationName.includes("/status")){let t=JSON.parse(e.payloadString);for(let e in t.state.relays)oe.state.relays[e]=t.state.relays[e];oe.state.event_timers_enabled=t.state.event_timers_enabled,oe.state.datetime=t.datetime}else if(e.destinationName.includes("/event_timers/list")){let t=JSON.parse(e.payloadString);oe.state.event_timers=t}else if(e.destinationName.includes("/event_timers/changed")){let t=JSON.parse(e.payloadString);oe.state.event_timer_changed=t}}catch(e){console.error("onMessageArrived() error",e)}};let he=!1;const ce=function(){he||de.connect({onSuccess:pe})};ce(),setInterval((function(){ce()}),1e3);let ue=null;function pe(){he=!0,ue&&clearTimeout(ue),de.subscribe(`${ae}/#`);const e=new Paho.MQTT.Message("1");e.destinationName=`${ae}/request_status`,e.qos=0,de.send(e);const t=new Paho.MQTT.Message("1");t.destinationName=`${ae}/event_timers/request`,t.qos=0,de.send(t)}oe.onRelayToggle=function(e){if(!he)return null;const t=new Paho.MQTT.Message("1");t.destinationName=`sprinklers/front/channel/${e}/toggle`,t.qos=0,de.send(t)},oe.onEventTimersToggle=function(){if(!he)return null;const e=new Paho.MQTT.Message("1");e.destinationName="sprinklers/front/event_timers/toggle",e.qos=0,de.send(e)},oe.onEventTimerDelete=function(e){if(!he)return null;const t=new Paho.MQTT.Message(JSON.stringify({event_timer_id:e}));t.destinationName="sprinklers/front/event_timers/delete",t.qos=0,de.send(t)},oe.onEventTimerUpdate=function(e){if(!he)return null;const t=new Paho.MQTT.Message(JSON.stringify({event_timer:e}));t.destinationName="sprinklers/front/event_timers/update",t.qos=0,de.send(t)},oe.onEventTimerAdd=function(e,t){if(!he)return null;const n=new Paho.MQTT.Message(JSON.stringify({event_timer:e,uid:t}));n.destinationName="sprinklers/front/event_timers/add",n.qos=0,de.send(n)}})();